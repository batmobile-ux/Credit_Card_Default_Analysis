CREATE DATABASE [CreditRiskDB]

USE [CreditRiskDB]

CREATE TABLE Card_Defaults_ (
    ID INT PRIMARY KEY,
    LIMIT_BAL FLOAT,
    SEX INT,
    EDUCATION INT,
    MARRIAGE INT,
    AGE INT,
    PAY_0 INT,
    PAY_2 INT,
    PAY_3 INT,
    PAY_4 INT,
    PAY_5 INT,
    PAY_6 INT,
    BILL_AMT1 FLOAT,
    BILL_AMT2 FLOAT,
    BILL_AMT3 FLOAT,
    BILL_AMT4 FLOAT,
    BILL_AMT5 FLOAT,
    BILL_AMT6 FLOAT,
    PAY_AMT1 FLOAT,
    PAY_AMT2 FLOAT,
    PAY_AMT3 FLOAT,
    PAY_AMT4 FLOAT,
    PAY_AMT5 FLOAT,
    PAY_AMT6 FLOAT,
    default_ INT
);

BULK INSERT Card_Defaults_
FROM 'C:\Users\amanp\Downloads\UCI_Credit_Card.csv'
WITH (
    FIELDTERMINATOR = ',',
    ROWTERMINATOR = '\n',
    FIRSTROW = 2
);


ALTER TABLE Card_Defaults_
ALTER COLUMN SEX VARCHAR(10);

ALTER TABLE Card_Defaults_
ALTER COLUMN EDUCATION VARCHAR(20);

ALTER TABLE Card_Defaults_
ALTER COLUMN MARRIAGE VARCHAR(20);

ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_0 VARCHAR(20);
ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_2 VARCHAR(20);
ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_3 VARCHAR(20);
ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_4 VARCHAR(20);
ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_5 VARCHAR(20);
ALTER TABLE Card_Defaults_
ALTER COLUMN PAY_6 VARCHAR(20);

ALTER TABLE Card_Defaults_
ALTER COLUMN default_ VARCHAR(20);



-- update 

UPDATE Card_Defaults_
SET
    SEX = CASE
        WHEN SEX = 1 THEN 'Male'
        WHEN SEX = 2 THEN 'Female'
    END,

    MARRIAGE = CASE 
        WHEN MARRIAGE = 1 THEN 'Married'
        WHEN MARRIAGE = 2 THEN 'Single'
        WHEN MARRIAGE = 3 THEN 'Others'
        ELSE 'Unknown'
    END,

    EDUCATION = CASE
        WHEN EDUCATION = 1 THEN 'Graduate School'
        WHEN EDUCATION = 2 THEN 'University'
        WHEN EDUCATION = 3 THEN 'High School'
        WHEN EDUCATION = 4 THEN 'Others'
        ELSE 'Unknown'
    END,

    PAY_0 = CASE
        WHEN PAY_0 = -2 THEN 'No Consumption'
        WHEN PAY_0 = -1 THEN 'Pay Duly'
        WHEN PAY_0 = 0 THEN 'Paid On Time'
        WHEN PAY_0 BETWEEN 1 AND 8 THEN CONCAT(PAY_0, ' Months Delay')
        ELSE 'Unknown'
    END,

    PAY_2 = CASE
        WHEN PAY_2 = -2 THEN 'No Consumption'
        WHEN PAY_2 = -1 THEN 'Pay Duly'
        WHEN PAY_2 = 0 THEN 'Paid On Time'
        WHEN PAY_2 BETWEEN 1 AND 8 THEN CONCAT(PAY_2, ' Months Delay')
        ELSE 'Unknown'
    END,

    PAY_3 = CASE
        WHEN PAY_3 = -2 THEN 'No Consumption'
        WHEN PAY_3 = -1 THEN 'Pay Duly'
        WHEN PAY_3 = 0 THEN 'Paid On Time'
        WHEN PAY_3 BETWEEN 1 AND 8 THEN CONCAT(PAY_3, ' Months Delay')
        ELSE 'Unknown'
    END,

    PAY_4 = CASE
        WHEN PAY_4 = -2 THEN 'No Consumption'
        WHEN PAY_4 = -1 THEN 'Pay Duly'
        WHEN PAY_4 = 0 THEN 'Paid On Time'
        WHEN PAY_4 BETWEEN 1 AND 8 THEN CONCAT(PAY_4, ' Months Delay')
        ELSE 'Unknown'
    END,

    PAY_5 = CASE
        WHEN PAY_5 = -2 THEN 'No Consumption'
        WHEN PAY_5 = -1 THEN 'Pay Duly'
        WHEN PAY_5 = 0 THEN 'Paid On Time'
        WHEN PAY_5 BETWEEN 1 AND 8 THEN CONCAT(PAY_5, ' Months Delay')
        ELSE 'Unknown'
    END,

    PAY_6 = CASE
        WHEN PAY_6 = -2 THEN 'No Consumption'
        WHEN PAY_6 = -1 THEN 'Pay Duly'
        WHEN PAY_6 = 0 THEN 'Paid On Time'
        WHEN PAY_6 BETWEEN 1 AND 8 THEN CONCAT(PAY_6, ' Months Delay')
        ELSE 'Unknown'
    END,


    [default_] = CASE
        WHEN [default_] = 1 THEN 'YES'
        WHEN [default_] = 0 THEN 'NO'
        ELSE 'Unknown'
    END;

-- CHECKS

SELECT TOP 10 ID,PAY_4 FROM Card_Defaults_
WHERE PAY_4 = '1 MONTHS DELAY'
ORDER BY PAY_4

SELECT TOP 10 ID,EDUCATION FROM Card_Defaults_
WHERE EDUCATION = 'UNIVERSITY'
ORDER BY ID
